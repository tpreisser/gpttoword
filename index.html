<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;700&display=swap" rel="stylesheet">
    <title>R² Solutions · GPT → DOCX Converter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
      :root{
        --font:'Plus Jakarta Sans',sans-serif;
        --navy:#0a041a; --blue:#3c67e3; --violet:#8b5cf6;
        --light:#e2e8f0; --panel:rgba(20,15,40,.6); --panel-bd:rgba(139,92,246,.35);
        --field-bd:rgba(139,92,246,.35); --bd:#1f2937; --backdrop:rgba(4,7,20,.72);
      }
      html,body{margin:0;padding:0;height:100%;font-family:var(--font);background:var(--navy);color:var(--light);}
      body{display:flex;justify-content:center;text-align:center}
      body::before{content:'';position:fixed;left:0;top:0;width:520px;height:520px;background:radial-gradient(circle,var(--blue),var(--violet));filter:blur(180px);opacity:.35;pointer-events:none;animation:pan 22s ease-in-out infinite alternate;z-index:0}
      @keyframes pan{from{transform:translate(-40%,-40%) scale(1)}to{transform:translate(40%,40%) scale(1.5)}}
      .main{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;gap:1rem;padding:2rem 2rem 4rem;width:100%}
      .logo{width:min(900px,92vw);height:auto;display:block;margin:0 auto;transform:translateX(60px)}
      .sub{font-size:1.06rem;font-weight:400;max-width:900px;line-height:1.5;margin-top:.25rem;background:linear-gradient(90deg,#a7b7e8,#c6b2f8);-webkit-background-clip:text;background-clip:text;color:transparent}
      .box{margin-top:1.2rem;width:clamp(360px,92vw,1100px);background:var(--panel);border:1px solid var(--panel-bd);border-radius:20px;box-shadow:0 8px 32px rgba(0,0,0,.45);overflow:visible;display:flex;flex-direction:column;backdrop-filter:blur(10px)}
      .hdr{display:flex;align-items:center;justify-content:space-between;padding:.9rem 1.2rem;background:linear-gradient(90deg,var(--blue),var(--violet))}
      .hdr .l{display:flex;align-items:baseline;gap:10px}
      .hdr .title{font-weight:700;color:#fff;font-size:1.15rem}
      .hdr .v{font-weight:500;color:rgba(255,255,255,.8);font-size:.86rem}
      .dots{display:flex;gap:7px}.dot{width:10px;height:10px;border-radius:50%;background:rgba(255,255,255,.35)}
      .body{padding:18px;display:flex;flex-direction:column;gap:14px;text-align:left}
      .md{width:100%;min-height:320px;resize:vertical;background:#0a0f1e;border:1px solid var(--field-bd);color:#e2e8f0;border-radius:12px;padding:16px;box-sizing:border-box;font-size:1.05rem;line-height:1.6;outline:none}
      .controls{display:flex;gap:.8rem;flex-wrap:wrap;align-items:center;margin-top:10px}
      .filename{background:#0a0f1e;border:1px solid var(--field-bd);color:#e2e8f0;border-radius:12px;padding:.75rem 1rem;min-width:260px;flex:1}
      .btn{appearance:none;border:1px solid var(--bd);background:#10192e;color:#e6faff;border-radius:12px;padding:.75rem 1rem;font-weight:800;cursor:pointer;transition:.18s}
      .btn:hover{transform:translateY(-1px);border-color:#8b5cf6}
      .btn.good{border-color:#15b57b}
      /* Modal */
      .backdrop{position:fixed;inset:0;background:var(--backdrop);display:none;z-index:50}
      .modal{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);width:min(560px,92vw);background:#0b1022;border:1px solid var(--panel-bd);border-radius:16px;padding:18px;box-shadow:0 20px 50px rgba(0,0,0,.6);display:none;z-index:51;text-align:left}
      .modal h3{margin:0 0 8px}
      .choice{display:flex;flex-direction:column;row-gap:14px;margin:12px 0}
      .draglet{display:block;text-align:center;width:100%;box-sizing:border-box;padding:14px 16px;border-radius:999px;border:1px solid var(--field-bd);background:linear-gradient(90deg,rgba(60,103,227,.25),rgba(139,92,246,.25));color:#eef;font-weight:900;text-decoration:none;user-select:none;cursor:grab}
      .draglet:active{cursor:grabbing}
      .actions{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
      .toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#0a1a2e;border:1px solid #1e293b;padding:10px 14px;border-radius:10px;color:#e2f3ff;display:none;z-index:60}
    </style>
</head>
<body>
  <div class="main">
    <img class="logo" src="https://drive.google.com/thumbnail?id=1E2DohDh27ZnzCyYT9hSL1aanKdLQbDla&sz=s4000" alt="R² Solutions"/>
    <p class="sub">Powered by AI · Built by R² Solutions</p>

    <div class="box">
      <div class="hdr">
        <div class="l"><span class="title">R² Solutions · GPT → DOCX Converter</span><span class="v">v3.0</span></div>
        <div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>
      </div>
      <div class="body">
        <textarea id="md" class="md" placeholder="Paste ChatGPT HTML here (use the bookmarklet)"></textarea>
        <div class="controls">
          <input id="filename" class="filename" type="text" value="R2 GPT Export.docx"/>
          <button onclick="testPaste()" class="btn">Paste from Clipboard</button>
          <button onclick="testDownload()" class="btn good" title="Build a native .docx (no CDNs)">Download .docx</button>
          <button onclick="testClear()" class="btn" style="background:#0f1a2e">Clear</button>
          <button onclick="testAlert()" class="btn" title="Install the one-click ChatGPT copier">Get Bookmarklet</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bookmarklet Modal -->
  <div id="mbBackdrop" class="backdrop"></div>
  <div id="mb" class="modal">
    <h3>Drag your preferred button into your bookmarks bar</h3>
    <div class="choice">
      <a id="dragLast" class="draglet" href="#" draggable="true">R2 GPT Convert — Last</a>
      <a id="dragAll"  class="draglet" href="#" draggable="true">R2 GPT Convert — Whole</a>
    </div>
    <div class="actions">
      <button onclick="closeModal()" class="btn" style="background:#0f1a2e">Close</button>
    </div>
  </div>
  <div id="toast" class="toast"></div>

  <script>
    function testClear() {
      console.log('Clear button clicked');
      document.getElementById('md').value = '';
      alert('Cleared!');
    }
    
    function testPaste() {
      console.log('Paste button clicked');
      navigator.clipboard.readText().then(function(text) {
        if (text && text.trim()) {
          document.getElementById('md').value = text;
          alert('Pasted text from clipboard!');
        } else {
          alert('No text in clipboard!');
        }
      }).catch(function(error) {
        alert('Clipboard access failed. Try manual paste.');
      });
    }
    
    function testDownload() {
      console.log('Download button clicked');
      const content = document.getElementById('md').value;
      if (!content.trim()) {
        alert('No content to download!');
        return;
      }
      
      console.log('Content:', content);
      console.log('docx library available:', typeof docx);
      
      // Use JSZip to create a proper DOCX
      const zip = new JSZip();
      
      // Add the required files
      zip.file('[Content_Types].xml', `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
  <Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml"/>
  <Default Extension="xml" ContentType="application/xml"/>
  <Override PartName="/word/document.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.document.main+xml"/>
  <Override PartName="/word/numbering.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.numbering+xml"/>
  <Override PartName="/word/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.wordprocessingml.styles+xml"/>
</Types>`);
      
      zip.file('_rels/.rels', `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">
  <Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="word/document.xml"/>
  <Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/numbering" Target="word/numbering.xml"/>
  <Relationship Id="rId3" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="word/styles.xml"/>
</Relationships>`);
      
      // Parse HTML content and convert to Word XML
      function htmlToWordXml(htmlContent) {
        // Create a temporary div to parse HTML
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = htmlContent;
        
        let wordXml = '';
        
        // Process each child node
        function processNode(node) {
          if (node.nodeType === Node.TEXT_NODE) {
            // Plain text
            const text = node.textContent.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
            if (text.trim()) {
              wordXml += `<w:t>${text}</w:t>`;
            }
          } else if (node.nodeType === Node.ELEMENT_NODE) {
            const tagName = node.tagName.toLowerCase();
            
            switch (tagName) {
              case 'h1':
              case 'h2':
              case 'h3':
              case 'h4':
              case 'h5':
              case 'h6':
                // Headers
                wordXml += `<w:p><w:pPr><w:pStyle w:val="Heading${tagName.charAt(1)}"/></w:pPr><w:r><w:rPr><w:b/><w:sz w:val="${32 - (tagName.charAt(1) * 2)}"/></w:rPr>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r></w:p>`;
                break;
                
              case 'p':
                // Paragraphs with spacing
                wordXml += `<w:p><w:pPr><w:spacing w:before="120" w:after="120"/></w:pPr><w:r>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r></w:p>`;
                break;
                
              case 'strong':
              case 'b':
                // Bold text
                wordXml += `<w:r><w:rPr><w:b/></w:rPr>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r>`;
                break;
                
              case 'em':
              case 'i':
                // Italic text
                wordXml += `<w:r><w:rPr><w:i/></w:rPr>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r>`;
                break;
                
              case 'code':
                // Code (monospace)
                wordXml += `<w:r><w:rPr><w:rFonts w:ascii="Courier New" w:hAnsi="Courier New"/></w:rPr>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r>`;
                break;
                
              case 'pre':
                // Code block
                wordXml += `<w:p><w:pPr><w:pStyle w:val="CodeBlock"/></w:pPr><w:r><w:rPr><w:rFonts w:ascii="Courier New" w:hAnsi="Courier New"/></w:rPr>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r></w:p>`;
                break;
                
              case 'ul':
                // Unordered list
                Array.from(node.children).forEach(li => {
                  if (li.tagName.toLowerCase() === 'li') {
                    wordXml += `<w:p><w:pPr><w:numPr><w:ilvl w:val="0"/><w:numId w:val="1"/></w:numPr></w:pPr><w:r>`;
                    Array.from(li.childNodes).forEach(processNode);
                    wordXml += `</w:r></w:p>`;
                  }
                });
                break;
                
              case 'ol':
                // Ordered list
                Array.from(node.children).forEach((li, index) => {
                  if (li.tagName.toLowerCase() === 'li') {
                    wordXml += `<w:p><w:pPr><w:numPr><w:ilvl w:val="0"/><w:numId w:val="2"/></w:numPr></w:pPr><w:r>`;
                    Array.from(li.childNodes).forEach(processNode);
                    wordXml += `</w:r></w:p>`;
                  }
                });
                break;
                
              case 'table':
                // Table with proper structure and shading
                wordXml += `<w:tbl><w:tblPr><w:tblStyle w:val="TableGrid"/><w:tblW w:w="0" w:type="auto"/></w:tblPr>`;
                Array.from(node.children).forEach(processNode);
                wordXml += `</w:tbl>`;
                break;
                
              case 'tr':
                // Table row
                wordXml += `<w:tr>`;
                Array.from(node.children).forEach(processNode);
                wordXml += `</w:tr>`;
                break;
                
              case 'td':
                // Table cell (regular)
                wordXml += `<w:tc><w:tcPr><w:tcW w:w="2000" w:type="dxa"/><w:shd w:val="clear" w:color="auto" w:fill="FFFFFF"/></w:tcPr><w:p><w:r>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r></w:p></w:tc>`;
                break;
                
              case 'th':
                // Table header cell (shaded)
                wordXml += `<w:tc><w:tcPr><w:tcW w:w="2000" w:type="dxa"/><w:shd w:val="clear" w:color="auto" w:fill="E7E6E6"/></w:tcPr><w:p><w:r><w:rPr><w:b/></w:rPr>`;
                Array.from(node.childNodes).forEach(processNode);
                wordXml += `</w:r></w:p></w:tc>`;
                break;
                
              case 'br':
                // Line break
                wordXml += `</w:r></w:p><w:p><w:r>`;
                break;
                
              case 'hr':
                // Horizontal line/divider
                wordXml += `</w:r></w:p><w:p><w:pPr><w:pBdr><w:bottom w:val="single" w:sz="6" w:space="1" w:color="CCCCCC"/></w:pBdr><w:spacing w:before="240" w:after="240"/></w:pPr><w:r><w:t></w:t></w:r></w:p><w:p><w:r>`;
                break;
                
              case 'div':
                // Check for dividers or sections
                if (node.className && (node.className.includes('divider') || node.className.includes('separator') || node.className.includes('border'))) {
                  // Add extra spacing for dividers
                  wordXml += `</w:r></w:p><w:p><w:pPr><w:spacing w:before="360" w:after="360"/></w:pPr><w:r><w:t></w:t></w:r></w:p><w:p><w:r>`;
                } else {
                  // Regular div with extra spacing
                  wordXml += `</w:r></w:p><w:p><w:pPr><w:spacing w:before="120" w:after="120"/></w:pPr><w:r>`;
                  Array.from(node.childNodes).forEach(processNode);
                  wordXml += `</w:r></w:p><w:p><w:r>`;
                }
                break;
                
              default:
                // Process child nodes for unknown tags
                Array.from(node.childNodes).forEach(processNode);
                break;
            }
          }
        }
        
        // Process all nodes
        Array.from(tempDiv.childNodes).forEach(processNode);
        
        return wordXml;
      }
      
      // Convert content to Word XML
      const wordContent = htmlToWordXml(content);
      
      zip.file('word/document.xml', `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:body>
    ${wordContent}
  </w:body>
</w:document>`);
      
      // Add numbering definitions for lists
      zip.file('word/numbering.xml', `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:numbering xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:abstractNum w:abstractNumId="0">
    <w:nsid w:val="00000001"/>
    <w:multiLevelType w:val="hybridMultilevel"/>
    <w:lvl w:ilvl="0">
      <w:start w:val="1"/>
      <w:numFmt w:val="bullet"/>
      <w:lvlText w:val="•"/>
      <w:lvlJc w:val="left"/>
      <w:pPr><w:ind w:left="720" w:hanging="360"/></w:pPr>
      <w:rPr><w:rFonts w:ascii="Symbol" w:hAnsi="Symbol" w:hint="default"/></w:rPr>
    </w:lvl>
  </w:abstractNum>
  <w:abstractNum w:abstractNumId="1">
    <w:nsid w:val="00000002"/>
    <w:multiLevelType w:val="hybridMultilevel"/>
    <w:lvl w:ilvl="0">
      <w:start w:val="1"/>
      <w:numFmt w:val="decimal"/>
      <w:lvlText w:val="%1."/>
      <w:lvlJc w:val="left"/>
      <w:pPr><w:ind w:left="720" w:hanging="360"/></w:pPr>
    </w:lvl>
  </w:abstractNum>
  <w:num w:numId="1">
    <w:abstractNumId w:val="0"/>
  </w:num>
  <w:num w:numId="2">
    <w:abstractNumId w:val="1"/>
  </w:num>
</w:numbering>`);
      
      // Add styles for headers and formatting
      zip.file('word/styles.xml', `<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<w:styles xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
  <w:docDefaults>
    <w:rPrDefault>
      <w:rPr>
        <w:rFonts w:ascii="Calibri" w:eastAsia="Calibri" w:hAnsi="Calibri" w:cs="Calibri"/>
        <w:lang w:val="en-US" w:eastAsia="en-US" w:bidi="ar-SA"/>
      </w:rPr>
    </w:rPrDefault>
  </w:docDefaults>
  <w:latentStyles w:defLockedState="0" w:defUIPriority="99" w:defSemiHidden="0" w:defUnhideWhenUsed="0" w:defQFormat="0" w:count="371">
    <w:lsdException w:name="Normal" w:uiPriority="0" w:qFormat="1"/>
    <w:lsdException w:name="heading 1" w:uiPriority="9" w:qFormat="1"/>
    <w:lsdException w:name="heading 2" w:uiPriority="9" w:qFormat="1"/>
    <w:lsdException w:name="heading 3" w:uiPriority="9" w:qFormat="1"/>
  </w:latentStyles>
  <w:style w:type="paragraph" w:default="1" w:styleId="Normal">
    <w:name w:val="Normal"/>
    <w:qFormat/>
  </w:style>
  <w:style w:type="paragraph" w:styleId="Heading1">
    <w:name w:val="heading 1"/>
    <w:basedOn w:val="Normal"/>
    <w:next w:val="Normal"/>
    <w:link w:val="Heading1Char"/>
    <w:uiPriority w:val="9"/>
    <w:qFormat/>
    <w:rsid w:val="00000001"/>
    <w:pPr>
      <w:spacing w:before="240" w:after="0"/>
      <w:outlineLvl w:val="0"/>
    </w:pPr>
    <w:rPr>
      <w:rFonts w:ascii="Calibri Light" w:eastAsia="Calibri Light" w:hAnsi="Calibri Light" w:cs="Calibri Light"/>
      <w:color w:val="2F5496"/>
      <w:sz w:val="32"/>
      <w:szCs w:val="32"/>
    </w:rPr>
  </w:style>
  <w:style w:type="paragraph" w:styleId="Heading2">
    <w:name w:val="heading 2"/>
    <w:basedOn w:val="Normal"/>
    <w:next w:val="Normal"/>
    <w:link w:val="Heading2Char"/>
    <w:uiPriority w:val="9"/>
    <w:qFormat/>
    <w:rsid w:val="00000001"/>
    <w:pPr>
      <w:spacing w:before="240" w:after="0"/>
      <w:outlineLvl w:val="1"/>
    </w:pPr>
    <w:rPr>
      <w:rFonts w:ascii="Calibri Light" w:eastAsia="Calibri Light" w:hAnsi="Calibri Light" w:cs="Calibri Light"/>
      <w:color w:val="2F5496"/>
      <w:sz w:val="26"/>
      <w:szCs w:val="26"/>
    </w:rPr>
  </w:style>
  <w:style w:type="paragraph" w:styleId="Heading3">
    <w:name w:val="heading 3"/>
    <w:basedOn w:val="Normal"/>
    <w:next w:val="Normal"/>
    <w:link w:val="Heading3Char"/>
    <w:uiPriority w:val="9"/>
    <w:qFormat/>
    <w:rsid w:val="00000001"/>
    <w:pPr>
      <w:spacing w:before="240" w:after="0"/>
      <w:outlineLvl w:val="2"/>
    </w:pPr>
    <w:rPr>
      <w:rFonts w:ascii="Calibri Light" w:eastAsia="Calibri Light" w:hAnsi="Calibri Light" w:cs="Calibri Light"/>
      <w:color w:val="1F3763"/>
      <w:sz w:val="24"/>
      <w:szCs w:val="24"/>
    </w:rPr>
  </w:style>
  <w:style w:type="character" w:styleId="Heading1Char">
    <w:name w:val="Heading 1 Char"/>
    <w:basedOn w:val="DefaultParagraphFont"/>
    <w:link w:val="Heading1"/>
    <w:uiPriority w:val="9"/>
    <w:rsid w:val="00000001"/>
    <w:rPr>
      <w:rFonts w:ascii="Calibri Light" w:eastAsia="Calibri Light" w:hAnsi="Calibri Light" w:cs="Calibri Light"/>
      <w:color w:val="2F5496"/>
      <w:sz w:val="32"/>
      <w:szCs w:val="32"/>
    </w:rPr>
  </w:style>
  <w:style w:type="character" w:styleId="Heading2Char">
    <w:name w:val="Heading 2 Char"/>
    <w:basedOn w:val="DefaultParagraphFont"/>
    <w:link w:val="Heading2"/>
    <w:uiPriority w:val="9"/>
    <w:rsid w:val="00000001"/>
    <w:rPr>
      <w:rFonts w:ascii="Calibri Light" w:eastAsia="Calibri Light" w:hAnsi="Calibri Light" w:cs="Calibri Light"/>
      <w:color w:val="2F5496"/>
      <w:sz w:val="26"/>
      <w:szCs w:val="26"/>
    </w:rPr>
  </w:style>
  <w:style w:type="character" w:styleId="Heading3Char">
    <w:name w:val="Heading 3 Char"/>
    <w:basedOn w:val="DefaultParagraphFont"/>
    <w:link w:val="Heading3"/>
    <w:uiPriority w:val="9"/>
    <w:rsid w:val="00000001"/>
    <w:rPr>
      <w:rFonts w:ascii="Calibri Light" w:eastAsia="Calibri Light" w:hAnsi="Calibri Light" w:cs="Calibri Light"/>
      <w:color w:val="1F3763"/>
      <w:sz w:val="24"/>
      <w:szCs w:val="24"/>
    </w:rPr>
  </w:style>
  <w:style w:type="table" w:styleId="TableGrid">
    <w:name w:val="Table Grid"/>
    <w:basedOn w:val="NormalTable"/>
    <w:uiPriority w:val="39"/>
    <w:rsid w:val="00000001"/>
    <w:tblPr>
      <w:tblBorders>
        <w:top w:val="single" w:sz="4" w:space="0" w:color="auto"/>
        <w:left w:val="single" w:sz="4" w:space="0" w:color="auto"/>
        <w:bottom w:val="single" w:sz="4" w:space="0" w:color="auto"/>
        <w:right w:val="single" w:sz="4" w:space="0" w:color="auto"/>
        <w:insideH w:val="single" w:sz="4" w:space="0" w:color="auto"/>
        <w:insideV w:val="single" w:sz="4" w:space="0" w:color="auto"/>
      </w:tblBorders>
    </w:tblPr>
  </w:style>
  <w:style w:type="table" w:styleId="NormalTable">
    <w:name w:val="Normal Table"/>
    <w:uiPriority w:val="99"/>
    <w:semiHidden/>
    <w:unhideWhenUsed/>
    <w:tblPr>
      <w:tblInd w:w="0" w:type="dxa"/>
    </w:tblPr>
    <w:tblGrid>
      <w:gridCol w:w="2000"/>
    </w:tblGrid>
  </w:style>
</w:styles>`);
      
      // Generate the ZIP file
      zip.generateAsync({type: 'blob'}).then(function(blob) {
        const base = (document.getElementById('filename').value || 'R2 GPT Export').replace(/\.(docx|rtf|txt)$/i, '');
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = base + '.docx';
        document.body.appendChild(a);
        a.click();
        setTimeout(() => {
          URL.revokeObjectURL(a.href);
          a.remove();
        }, 400);
        alert('✅ DOCX document downloaded!');
      });
    }
    
    function testAlert() {
      console.log('Alert button clicked');
      
      // Create the actual bookmarklet code
      const bookmarkletLast = `javascript:(function(){
        const responses = document.querySelectorAll('[data-message-author-role="assistant"]');
        if (responses.length > 0) {
          const lastResponse = responses[responses.length - 1];
          const content = lastResponse.querySelector('.markdown');
          if (content) {
            navigator.clipboard.writeText(content.innerText || content.textContent);
            alert('Last ChatGPT response copied!');
          } else {
            alert('Could not find response content');
          }
        } else {
          alert('No ChatGPT responses found');
        }
      })();`;
      
      const bookmarkletAll = `javascript:(function(){
        const responses = document.querySelectorAll('[data-message-author-role="assistant"]');
        if (responses.length > 0) {
          let allText = '';
          responses.forEach(response => {
            const content = response.querySelector('.markdown');
            if (content) {
              allText += (content.innerText || content.textContent) + '\\n\\n';
            }
          });
          navigator.clipboard.writeText(allText.trim());
          alert('All ChatGPT responses copied!');
        } else {
          alert('No ChatGPT responses found');
        }
      })();`;
      
      // Update the bookmarklet links
      document.getElementById('dragLast').href = bookmarkletLast;
      document.getElementById('dragAll').href = bookmarkletAll;
      
      document.getElementById('mb').style.display = 'block';
      document.getElementById('mbBackdrop').style.display = 'block';
    }
    
    function closeModal() {
      document.getElementById('mb').style.display = 'none';
      document.getElementById('mbBackdrop').style.display = 'none';
    }
    
    console.log('Script loaded successfully');
  </script>
</body>
</html>
